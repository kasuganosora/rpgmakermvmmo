# Task 09-09 - mmo-party.jsï¼ˆç»„é˜Ÿé¢æ¿ï¼‰

> **ä¼˜å…ˆçº§**ï¼šP1ï¼ˆM4ï¼‰
> **é‡Œç¨‹ç¢‘**ï¼šM4
> **ä¾èµ–**ï¼štask-09-01ï¼ˆmmo-coreï¼‰ã€task-09-05ï¼ˆmmo-hudï¼Œå·¦ä¸­åŒºåŸŸï¼‰

---

## ç›®æ ‡

å®ç°å·¦ä¸­åŒºåŸŸç»„é˜Ÿé¢æ¿ï¼šæ˜¾ç¤ºæ¯ä¸ªé˜Ÿå‘˜çš„ HP/MP æ¡å’Œ Buff å›¾æ ‡åˆ—è¡¨ã€‚å®ç°ç»„é˜Ÿé‚€è¯·/æ¥å—/è¸¢äºº/è½¬è®©é˜Ÿé•¿çš„å®Œæ•´äº¤äº’æµç¨‹ã€‚

---

## Todolist

- [ ] **09-1** `Window_PartyPanel`ï¼ˆå·¦ä¸­ï¼Œç»„é˜Ÿæ—¶æ˜¾ç¤ºï¼‰
  - [ ] æ¯ä¸ªé˜Ÿå‘˜ä¸€è¡Œï¼šæ˜µç§° + èŒä¸šå›¾æ ‡ + HP æ¡ + MP æ¡ + Buff å›¾æ ‡åˆ—è¡¨
  - [ ] ä¸åœ¨åŒä¸€åœ°å›¾çš„é˜Ÿå‘˜ï¼šHP æ¡ç½®ç° + `[ä¸åŒåœ°å›¾]` æ ‡ç­¾
  - [ ] ç¦»çº¿é˜Ÿå‘˜ï¼šæ•´è¡ŒåŠé€æ˜ + `[ç¦»çº¿]` æ ‡ç­¾
  - [ ] æ— é˜Ÿä¼æ—¶éšè—é¢æ¿
- [ ] **09-2** æ¥æ”¶ `party_update` æ¶ˆæ¯ï¼ˆæ¯ 1s æœåŠ¡ç«¯æ¨é€ï¼‰
  - [ ] å…¨é‡åˆ·æ–°é˜Ÿä¼çŠ¶æ€ï¼ˆæˆå‘˜åˆ—è¡¨ã€HP/MPã€Buffï¼‰
  - [ ] é˜Ÿä¼è§£æ•£ï¼ˆmembers ä¸ºç©ºï¼‰æ—¶éšè—é¢æ¿
- [ ] **09-3** ç»„é˜Ÿé‚€è¯·å‘é€
  - [ ] å³é”®ç‚¹å‡»åœ°å›¾ä¸Šå…¶ä»–ç©å®¶ç²¾çµ â†’ å¼¹å‡ºèœå•ï¼ˆé‚€è¯·ç»„é˜Ÿ/ç§èŠï¼‰
  - [ ] é€‰æ‹©é‚€è¯· â†’ `party_invite{target_player_id}`
- [ ] **09-4** æ”¶åˆ°é‚€è¯·é€šçŸ¥ï¼ˆæœåŠ¡ç«¯ WS æ¨é€ `party_invite_request`ï¼‰
  - [ ] å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š`[A] é‚€è¯·ä½ åŠ å…¥é˜Ÿä¼ï¼Œæ˜¯å¦æ¥å—ï¼Ÿ`
  - [ ] 30s å€’è®¡æ—¶è‡ªåŠ¨æ‹’ç»
  - [ ] æ¥å— â†’ `party_invite_response{accept: true}`
  - [ ] æ‹’ç» â†’ `party_invite_response{accept: false}`
- [ ] **09-5** é˜Ÿé•¿æ“ä½œï¼ˆå³é”®é˜Ÿå‘˜è¡Œï¼‰
  - [ ] è¸¢å‡ºé˜Ÿå‘˜ â†’ `party_kick{target_player_id}`ï¼ˆéœ€ç¡®è®¤ï¼‰
  - [ ] è½¬è®©é˜Ÿé•¿ â†’ `party_transfer_leader{target_player_id}`
- [ ] **09-6** ç¦»é˜ŸæŒ‰é’®ï¼ˆé¢æ¿åº•éƒ¨å°æŒ‰é’®ï¼‰
  - [ ] ç‚¹å‡» â†’ `party_leave`
  - [ ] è‡ªå·±æ˜¯é˜Ÿé•¿æ—¶ï¼šæç¤ºå…ˆè½¬è®©é˜Ÿé•¿æˆ–è§£æ•£é˜Ÿä¼

---

## å®ç°ç»†èŠ‚ä¸æ€è·¯

### é¢æ¿å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜Ÿä¼ [4/4]           [ç¦»é˜Ÿ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ—¡ Alice  Lv.10             â”‚
â”‚ HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  80/120       â”‚
â”‚ MP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  25/60        â”‚
â”‚ [ä¸­æ¯’] [åŠ é€Ÿ]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›¡ Bob    Lv.8    [ä¸åŒåœ°å›¾] â”‚
â”‚ HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100/100      â”‚
â”‚ MP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  60/60        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### party_update åˆ·æ–°

```javascript
$MMO.on('party_update', function (payload) {
    $MMO._partyData = payload;
    if (!$MMO._partyPanel) return;

    if (!payload.members || payload.members.length === 0) {
        $MMO._partyPanel.hide();
        return;
    }
    $MMO._partyPanel.setData(payload);
    $MMO._partyPanel.refresh();
    $MMO._partyPanel.show();
});
```

### Buff å›¾æ ‡ç»˜åˆ¶

Buff å›¾æ ‡åŒæ ·ä½¿ç”¨ `img/system/IconSet.png`ï¼ˆå„ State çš„ `iconIndex` å­—æ®µï¼‰ï¼š

```javascript
Window_PartyPanel.prototype._drawBuffIcons = function (buffs, x, y) {
    buffs.forEach(function (buff, i) {
        var state = $MMO._resource.states[buff.buff_id];
        if (!state) return;
        var iconX = (state.iconIndex % 16) * 32;
        var iconY = Math.floor(state.iconIndex / 16) * 32;
        this.contents.blt(
            ImageManager.loadSystem('IconSet'),
            iconX, iconY, 32, 32,
            x + i * 22, y, 20, 20
        );
    }, this);
};
```

---

## éªŒæ”¶æ ‡å‡†

1. åŠ å…¥é˜Ÿä¼åå·¦ä¸­æ˜¾ç¤ºç»„é˜Ÿé¢æ¿ï¼Œæ‰€æœ‰é˜Ÿå‘˜ HP/MP å®æ—¶æ›´æ–°
2. æ”¶åˆ°ç»„é˜Ÿé‚€è¯·å¼¹å‡ºç¡®è®¤å¼¹çª—ï¼Œ30s åè‡ªåŠ¨æ‹’ç»
3. é˜Ÿé•¿å³é”®é˜Ÿå‘˜è¡Œå¯è¸¢äºº/è½¬è®©é˜Ÿé•¿
4. ç¦»é˜Ÿåé¢æ¿éšè—
5. ä¸åœ¨åŒä¸€åœ°å›¾çš„é˜Ÿå‘˜æ˜¾ç¤ºç°è‰²çŠ¶æ€
